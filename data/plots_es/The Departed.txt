Ya de niño, Colin Sullivan (Matt Damon) entra en contacto con la delincuencia organizada que gira en torno al jefe de la mafia irlandesa Frank Costello (Jack Nicholson) en el barrio de South Boston. Costello lo prepara para convertirlo en un topo dentro de la policía del estado de Massachusetts. Sullivan es aceptado en la Unidad de Investigaciones Especiales, que se centra en el crimen organizado. Por otro lado, el capitán Queenan (Martin Sheen) y el sargento Dignam (Mark Wahlberg) le plantean a Billy Costigan (Leonardo DiCaprio), poco antes de su graduación en la academia de policía, si accedería a trabajar como policía infiltrado, dados sus vínculos familiares con la mafia y los enormes recelos y antipatías que despertaría dentro del Cuerpo. Abandona la academia y se le hace pasar un tiempo en la cárcel bajo una acusación falsa por asalto para aumentar así su credibilidad como delincuente.
Dado que deben infiltrarse en sus respectivas organizaciones, Sullivan comienza un romance con la psiquiatra Madolyn Madden (Vera Farmiga). Costigan la ve durante su libertad condicional y también desarrolla una relación con ella. Después de que Costello escape de una operación encubierta, ambas partes toman conciencia de la existencia de un topo en su grupo. Sullivan dice que encontrará a la «rata» y le pide a Costello información sobre sus hombres para determinar quién puede ser el informante dentro de su organización. Costigan sigue a Costello a una sala de cine, donde Costello le da a Sullivan un sobre con información personal sobre los miembros de su organización. Costigan entonces persigue a Sullivan por el barrio chino para verle la cara y este intenta tenderle una trampa, pero al final ninguno de ellos consigue averiguar la identidad del otro. Poco después, Sullivan descubre que Queenan va a reunirse con su infiltrado, y encarga a policías a su mando que sigan los movimientos de Queenan con la excusa que puede ser el topo; pero cuando están vigilando en el lugar en que va a verse con Costigan, entran en ese lugar los hombres de Costello: Queenan logra que Costigan escape, pero muere a manos de esos hombres. Al ser visto allí, Costigan finge que había venido a unirse a ellos. Más tarde, el hombre de confianza de Costello, Fitzgibbons (David O'Hara), revela que Delahunt (Mark Rolston), un miembro de su organización, era un policía encubierto. Tras los dos fiascos, Dignam se ve obligado a dimitir.
Usando el teléfono de Queenan, Sullivan llega hasta Costigan, que se niega a abortar su misión. Sullivan se entera del papel de Costello como informante de la Oficina Federal de Investigación a partir del diario de Queenan, preocupándole que su identidad sea revelada. Con la ayuda de Costigan, Costello se ve inmerso en una redada, donde estalla un tiroteo entre su gente y la policía, donde la mayor parte de sus hombres mueren. Costello, ante Sullivan, admite que es un ocasional informante del FBI. Sullivan luego le dispara varias veces. Con Costello muerto, Sullivan es recibido como un héroe al día siguiente dentro del cuerpo. Con buena fe, Costigan se acerca a él para la restauración de su verdadera identidad, pero ve en el escritorio de Sullivan la documentación sobre sus hombres que le dio Costello (descubriendo que era el informante del mafioso) y huye. Sabiendo que ha sido descubierto, Sullivan borra todos los registros de Costigan del sistema de ordenador de la policía.
Madolyn le dice a Sullivan que está embarazada, pero no revela quién es el padre. Más tarde, ella descubre un paquete de Costigan que contiene un CD con las grabaciones de las conversaciones de Sullivan con Costello. Sullivan camina mientras se escucha y trata sin éxito de calmar sus sospechas. Se pone en contacto con Costigan, que revela que Costello había registrado cada conversación que tuvo con Sullivan. El abogado de Costello dejó a Costigan en posesión de las grabaciones y tiene la intención de implicar a Sullivan. Están de acuerdo en reunirse en el edificio donde Queenan murió.
En la terraza, Costigan captura a Sullivan con la guardia baja y lo esposa. Como Costigan había organizado en secreto, el oficial Brown (Anthony Anderson) aparece también en la terraza. Conmocionado, Brown saca su arma y apunta a Costigan, que trata de justificar sus acciones mediante la revelación de Sullivan como la «rata». Costigan le pregunta a Brown por qué Dignam no lo acompaña, pero Brown no contesta. Costigan lleva a Sullivan hasta el ascensor. Cuando llega a la planta baja, Costigan recibe un disparo en la cabeza por el agente Barrigan (James Badge Dale), quien también dispara a Brown y le revela a Sullivan que él también es un topo de Costello. Cuando Barrigan gira, Sullivan le dispara en la cabeza. En la sede de la policía, Sullivan identifica a Barrigan como el topo y a Costigan se le concede a título póstumo la Medalla al Mérito.
En el funeral de Costigan, Sullivan y Madolyn están en la tumba. Sullivan le pregunta qué va a pasar con el bebé, pero ella no le hace caso. Algún tiempo después, cuando Sullivan entra en su apartamento, Dignam, vistiendo patucos de hospital y guantes quirúrgicos, le dispara en la cabeza con una pistola con silenciador. Cuando Dignam sale y deja el cuerpo de Sullivan en el apartamento, una rata corretea a través de la barandilla fuera de la ventana.
